<div class="text-center">
  <div class="btn-group pull-left">
    <button type="button" class="btn btn-default" ng-click="closeFile()">
      <span class="fas fa-times"></span>
    </button>
  </div>

  <div class="btn-group">
    <button type="button" class="btn btn-default"
            ng-style="{ 'visibility': previousFile() ? 'visible' : 'hidden' }"
            ng-click="goPreviousFile()">
      {{ 'file.view.previous' | translate }}
    </button>
    <button type="button" class="btn btn-default"
            ng-style="{ 'visibility': nextFile() ? 'visible' : 'hidden' }"
            ng-click="goNextFile()">
      {{ 'file.view.next' | translate }}
    </button>
    <button type="button" class="btn btn-placeholder" style="visibility: hidden">
      &nbsp;
    </button>
  </div>
  
  <div class="btn-group pull-right">
    <!-- 添加翻译按钮 -->
    <button type="button" class="btn btn-default" 
            uib-tooltip="{{ 'file.view.translate_tooltip' | translate }}" 
            tooltip-append-to-body="true" 
            ng-click="translateFile()" 
            ng-if="canTranslate">
      <span class="fas fa-language"></span>
    </button>
    <button type="button" class="btn btn-default" uib-tooltip="Print this file" tooltip-append-to-body="true" ng-click="printFile()">
      <span class="fas fa-print"></span>
    </button>
    <button type="button" class="btn btn-default" uib-tooltip="Download this file" tooltip-append-to-body="true" ng-click="openFile()">
      <span class="fas fa-download"></span>
    </button>
    <button type="button" class="btn btn-default" uib-tooltip="Show text content" tooltip-append-to-body="true" ng-click="openFileContent()">
      <span class="fas fa-eye"></span>
    </button>
  </div>
</div>

<div class="text-center" style="position: relative;" ng-if="$stateParams.fileId">
  <!-- Standard preview -->
  <img ng-src="../api/file/{{ $stateParams.fileId }}/data?size=web"
       ng-init="error = false"
       img-error="error = true"
       ng-show="!error && canDisplayPreview()" />

  <!-- Media player -->
  <a href class="video-overlay" ng-if="!error && (file.mimetype.substring(0, 6) == 'video/' || file.mimetype.substring(0, 6) == 'audio/')"
     ng-init="videoPlayer = false" ng-click="videoPlayer = true">
    <span class="fas fa-play-circle" ng-if="!videoPlayer"></span>
    <video ng-if="videoPlayer" autoplay="autoplay" loop="loop"
           controls="controls" ng-src="../api/file/{{ $stateParams.fileId }}/data"></video>
  </a>

  <!-- PDF viewer -->
  <iframe ng-src="{{ trustedFileUrl }}" class="pdf-viewer" scrolling="yes" ng-if="!error && file.mimetype == 'application/pdf'"></iframe>

  <!-- File not found -->
  <p class="well-lg" ng-show="error">
    <span class="fas fa-exclamation-triangle"></span>
    {{ 'file.view.not_found' | translate }}
  </p>
</div>

<!-- 定义翻译模态框模板 -->
<script type="text/ng-template" id="translateModal.html">
  <div class="modal-header">
    <button type="button" class="close" ng-click="cancel()">&times;</button>
    <h4 class="modal-title">{{ 'file.view.translate_title' | translate }}</h4>
  </div>
  <div class="modal-body">
    <form class="form-horizontal" name="translateForm" novalidate>
      <div class="form-group">
        <label class="col-sm-3 control-label">{{ 'file.view.source_language' | translate }}</label>
        <div class="col-sm-9">
          <select class="form-control" ng-model="translate.sourceLanguage" required>
            <option ng-repeat="language in languages" value="{{ language.code }}">{{ language.name }}</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label class="col-sm-3 control-label">{{ 'file.view.target_language' | translate }}</label>
        <div class="col-sm-9">
          <select class="form-control" ng-model="translate.targetLanguage" required>
            <option ng-repeat="language in languages" value="{{ language.code }}">{{ language.name }}</option>
          </select>
        </div>
      </div>
      
      <div class="alert alert-info" ng-if="apiNotConfigured">
        {{ 'file.view.translation_api_not_configured' | translate }}
      </div>
      
      <div class="progress" ng-if="translationInProgress">
        <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%">
          <span>{{ translate.statusText || ('file.view.translation_in_progress' | translate) }}</span>
        </div>
      </div>
      
      <div class="alert alert-success" ng-if="translate.statusCode == 4">
        {{ 'file.view.translation_complete' | translate }}
      </div>
      
      <div class="alert alert-danger" ng-if="translate.error">
        {{ translate.error }}
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-default" ng-click="cancel()">{{ 'close' | translate }}</button>
    <button type="button" class="btn btn-primary" ng-click="startTranslation()" 
            ng-disabled="!translate.sourceLanguage || !translate.targetLanguage || translationInProgress || apiNotConfigured">
      {{ 'file.view.start_translation' | translate }}
    </button>
    <a class="btn btn-success" ng-if="translate.statusCode == 4" 
       ng-click="downloadTranslation()">
      {{ 'file.view.download_translation' | translate }}
    </a>
  </div>
</script>